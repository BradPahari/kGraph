<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>CSV to Knowledge Graph</title>
    <script src="https://unpkg.com/vis-network@9.1.2/standalone/umd/vis-network.min.js"></script>
    <style>
        #graph {
            width: 100%;
            height: 600px;
            border: 1px solid lightgray;
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <h1>Upload CSV to Create Knowledge Graph</h1>
    <input type="file" id="csvFile" accept=".csv">
    <button onclick="uploadCSV()">Upload</button>
    <div id="graph"></div>
    <button onclick="downloadGraphImage()">Download Graph Image</button>

    <script>
        async function uploadCSV() {
            const fileInput = document.getElementById('csvFile');
            const file = fileInput.files[0];
            const formData = new FormData();
            formData.append('file', file);

            const response = await fetch('/upload', {
                method: 'POST',
                body: formData
            });

            const data = await response.json();
            drawGraph(data);
        }

        function drawGraph(graphData) {
            const nodes = new vis.DataSet(graphData.nodes);
            const edges = new vis.DataSet(graphData.edges);
            const container = document.getElementById('graph');
            const data = { nodes, edges };
            const options = { physics: { stabilization: false } };
            const network = new vis.Network(container, data, options);
            window.graphNetwork = network; // Store for image export
        }

        function downloadGraphImage() {
            const canvas = document.querySelector("#graph canvas");
            const link = document.createElement('a');
            link.download = 'knowledge_graph.png';
            link.href = canvas.toDataURL();
            link.click();
        }
    </script>
</body>

</html>